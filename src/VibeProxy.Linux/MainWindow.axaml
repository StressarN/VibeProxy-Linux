<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:VibeProxy.Linux.ViewModels"
        xmlns:conv="clr-namespace:VibeProxy.Linux.Utilities"
        x:Class="VibeProxy.Linux.MainWindow"
        Width="720" Height="540"
        Title="VibeProxy Linux"
        mc:Ignorable="d">
  <Window.DataContext>
    <vm:SettingsViewModel />
  </Window.DataContext>

  <Grid RowDefinitions="Auto,*" ColumnDefinitions="*">
    <StackPanel Orientation="Horizontal" Spacing="8" Margin="12">
      <Button Content="Start" Command="{Binding StartCommand}" Width="100" />
      <Button Content="Stop" Command="{Binding StopCommand}" Width="100" />
      <ToggleSwitch Content="Launch at Login" IsChecked="{Binding LaunchAtLoginEnabled, Mode=TwoWay}" />
      <TextBlock Text="{Binding ServerStatusText}" Margin="12,0,0,0" VerticalAlignment="Center" />
    </StackPanel>

    <Grid Grid.Row="1" ColumnDefinitions="2*,2*" RowDefinitions="Auto,*,Auto">
      <StackPanel Grid.Column="0" Margin="12" Spacing="8">
        <TextBlock Text="Authentication" FontWeight="SemiBold" />
        <StackPanel Spacing="4">
          <Button Content="Connect Claude" Command="{Binding ConnectClaudeCommand}" IsEnabled="{Binding IsAuthenticatingClaude, Converter={x:Static conv:BooleanNegationConverter.Instance}}" />
          <Button Content="Connect Codex" Command="{Binding ConnectCodexCommand}" IsEnabled="{Binding IsAuthenticatingCodex, Converter={x:Static conv:BooleanNegationConverter.Instance}}" />
          <Button Content="Connect Gemini" Command="{Binding ConnectGeminiCommand}" IsEnabled="{Binding IsAuthenticatingGemini, Converter={x:Static conv:BooleanNegationConverter.Instance}}" />
          <StackPanel Orientation="Horizontal" Spacing="6">
            <TextBox Width="200" Watermark="Qwen Email" Text="{Binding QwenEmail, Mode=TwoWay}" />
            <Button Content="Connect Qwen" Command="{Binding ConnectQwenCommand}" IsEnabled="{Binding IsAuthenticatingQwen, Converter={x:Static conv:BooleanNegationConverter.Instance}}" />
          </StackPanel>
          <Button Content="Open Auth Folder" Command="{Binding OpenAuthFolderCommand}" />
        </StackPanel>
      </StackPanel>

      <StackPanel Grid.Column="1" Margin="12" Spacing="8">
        <TextBlock Text="Status" FontWeight="SemiBold" />
        <ItemsControl ItemsSource="{Binding StatusItems}">
          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <StackPanel Orientation="Horizontal" Spacing="6">
                <TextBlock Text="{Binding Name}" Width="90" />
                <TextBlock Text="{Binding Status}" />
              </StackPanel>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </StackPanel>

      <StackPanel Grid.Row="1" Grid.ColumnSpan="2" Margin="12" Spacing="6">
        <TextBlock Text="Logs" FontWeight="SemiBold" />
        <Border Height="220" BorderBrush="Gray" BorderThickness="1">
          <ScrollViewer>
            <ItemsControl ItemsSource="{Binding LogLines}" />
          </ScrollViewer>
        </Border>
      </StackPanel>

      <StackPanel Grid.Row="2" Grid.ColumnSpan="2" Orientation="Horizontal" Margin="12" Spacing="10">
        <Button Content="Copy URL" Command="{Binding CopyUrlCommand}" />
        <TextBlock Text="{Binding VersionText}" VerticalAlignment="Center" />
      </StackPanel>
    </Grid>
  </Grid>
</Window>
